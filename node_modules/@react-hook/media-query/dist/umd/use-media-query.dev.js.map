{"version":3,"file":"use-media-query.dev.js","sources":["../../src/index.tsx"],"sourcesContent":["import * as React from 'react'\n\nfunction queriesDidChange(\n  prevQueries: MediaQueries<unknown>,\n  nextQueries: MediaQueries<unknown>\n): boolean {\n  if (nextQueries === prevQueries) return false\n  const nextQueriesArr = Object.values(nextQueries)\n  const prevQueriesArr = Object.values(prevQueries)\n  if (nextQueriesArr.length !== prevQueriesArr.length) return true\n  if (nextQueriesArr.some((q, i) => q !== prevQueriesArr[i])) return true\n  const prevKeys = Object.keys(prevQueries)\n  return Object.keys(nextQueries).some((n, i) => n !== prevKeys[i])\n}\n\nfunction init<T>(queries: MediaQueries<T>): State<T> {\n  const queryKeys = Object.keys(queries) as (keyof MediaQueries<T>)[]\n  /* istanbul ignore next */\n  if (typeof window === 'undefined')\n    return queryKeys.reduce(\n      (curr: State<any>, key) => {\n        curr.matches[key] = false\n        curr.mediaQueries[key] = {} as MediaQueryList\n        return curr\n      },\n      {mediaQueries: {}, matches: {}}\n    )\n\n  return queryKeys.reduce(\n    (state: State<any>, name): State<T> => {\n      const mql = window.matchMedia(queries[name])\n      state.mediaQueries[name] = mql\n      state.matches[name] = mql.matches\n      return state\n    },\n    {mediaQueries: {}, matches: {}}\n  )\n}\n\nfunction reducer<T>(state: State<T>, action: Action<T>): State<T> {\n  switch (action.type) {\n    case 'updateMatches':\n      return {\n        matches: Object.keys(state.mediaQueries).reduce(\n          (prev: Matches<any>, key: string) => {\n            prev[key] = state.mediaQueries[key as keyof T].matches\n            return prev\n          },\n          {}\n        ),\n        mediaQueries: state.mediaQueries,\n      }\n\n    case 'setQueries':\n      return init(action.queries)\n  }\n}\n\n/**\n * A hook that returns a [`MediaQueryMatches`](#mediaquerymatches) object which will\n * tell you if specific media queries matched, all media queries matched, or\n * any media queries matched. Matches in this hook will always return `false` when\n * rendering on the server.\n *\n * @param queryMap The media queries you want to match against e.g. `{screen: \"screen\", width: \"(min-width: 12em)\"}`\n */\nexport function useMediaQueries<T>(\n  queryMap: MediaQueries<T>\n): MediaQueryMatches<T> {\n  const prevQueries = React.useRef<MediaQueries<T>>(queryMap)\n  const [state, dispatch] = React.useReducer<\n    React.Reducer<State<T>, Action<T>>,\n    MediaQueries<T>\n  >(reducer, queryMap, init)\n\n  React.useEffect(() => {\n    if (queriesDidChange(queryMap, prevQueries.current)) {\n      dispatch({type: 'setQueries', queries: queryMap})\n      prevQueries.current = queryMap\n    }\n  }, [queryMap])\n\n  React.useEffect(() => {\n    const queries: MediaQueryList[] = Object.values(state.mediaQueries)\n    const callbacks: (() => void)[] = queries.map((mq) => {\n      const callback = () => dispatch({type: 'updateMatches'})\n      if (typeof mq.addListener !== 'undefined') mq.addListener(callback)\n      else mq.addEventListener('change', callback)\n\n      return callback\n    })\n\n    return () => {\n      queries.forEach((mq: MediaQueryList, i: number) => {\n        if (typeof mq.addListener !== 'undefined')\n          mq.removeListener(callbacks[i])\n        else mq.removeEventListener('change', callbacks[i])\n      })\n    }\n  }, [state.mediaQueries])\n\n  const {matches} = state\n  const matchValues = React.useMemo<boolean[]>(() => Object.values(matches), [\n    matches,\n  ])\n\n  return {\n    matches,\n    matchesAny: matchValues.some(Boolean),\n    matchesAll: matchValues.length > 0 && matchValues.every(Boolean),\n  }\n}\n\n/**\n * A hook that returns `true` if the media query matched and `false` if not. This\n * hook will always return `false` when rendering on the server.\n *\n * @param query The media query you want to match against e.g. `\"only screen and (min-width: 12em)\"`\n */\nexport function useMediaQuery(query: string) {\n  return useMediaQueries(getObj(query)).matchesAll\n}\n\nconst cache: Record<string, MediaQueries<{default: string}>> = {}\n\nfunction getObj(query: string): MediaQueries<{default: string}> {\n  if (cache[query] === void 0) cache[query] = {default: query}\n  return cache[query]\n}\n\nexport type MediaQueries<T> = {\n  [Name in keyof T]: string\n}\n\nexport type Matches<T> = {\n  [Name in keyof T]: boolean\n}\n\ninterface State<T> {\n  mediaQueries: {[Name in keyof T]: MediaQueryList}\n  matches: Matches<T>\n}\n\ntype UpdateMatchesAction = {\n  type: 'updateMatches'\n}\ntype SetQueriesAction<T> = {\n  type: 'setQueries'\n  queries: MediaQueries<T>\n}\ntype Action<T> = UpdateMatchesAction | SetQueriesAction<T>\n\nexport interface MediaQueryMatches<T> {\n  /**\n   * Returns a map of query key/didMatch pairs\n   */\n  matches: Matches<T>\n  /**\n   * `true` if any of the media queries matched\n   */\n  matchesAny: boolean\n  /**\n   * `true` if all of the media queries matched\n   */\n  matchesAll: boolean\n}\n"],"names":["queriesDidChange","prevQueries","nextQueries","nextQueriesArr","Object","values","prevQueriesArr","length","some","q","i","prevKeys","keys","n","curr","key","matches","mediaQueries","init","queries","queryKeys","window","reduce","state","name","mql","matchMedia","reducer","action","prev","type","useMediaQueries","queryMap","React","dispatch","current","mq","callback","addListener","addEventListener","callbacks","map","removeListener","removeEventListener","forEach","matchValues","matchesAny","Boolean","matchesAll","every","useMediaQuery","query","getObj","cache","default"],"mappings":"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"}